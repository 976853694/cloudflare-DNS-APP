# 更新日志

## 2026-01-02

### 首页样式修复
- 修复 `pages/index/index.vue` 缺失的 `<style>` 部分
- 添加完整的首页样式：导航栏、Hero区域、公告栏、统计区域、产品卡片、域名后缀、我的资产、快捷服务、特性区域、页脚等

### 虚拟主机文件管理修复
- 修复 `api/vhost.js` 文件管理 API：
  - `getFiles` 和 `readFile` 改用 URL 参数传递路径，兼容性更好
- 修复 `pages/vhost/detail.vue` 文件管理功能：
  - 改进 `loadFiles` 方法，增加更完善的路径构建逻辑和错误处理
  - 改进 `openFile` 方法，确保点击文件时正确构建完整路径
  - 改进 `showFileActions` 方法，确保选中文件有正确的路径
  - 改进 `editFile` 方法，增加路径验证、更好的内容解析和错误提示

### 虚拟主机用户端模块
- 新增 `api/vhost.js` 虚拟主机用户端 API：
  - 套餐相关：`getVHostPlans` 获取套餐列表
  - 购买相关：`purchaseVHost` 购买虚拟主机
  - 实例管理：`getVHostInstances`、`getVHostInstance`、`renewVHost`
  - 订单记录：`getVHostOrders`
  - 域名绑定：`getInstanceDomains`、`addInstanceDomain`、`deleteInstanceDomain`
  - 文件管理：`getFiles`、`readFile`、`saveFile`、`createFile`、`createDir`、`deleteFile`、`renameFile`、`copyFile`、`moveFile`、`zipFile`、`unzipFile`
  - PHP 版本：`getPhpVersions`、`setPhpVersion`
  - 运行目录：`getRunPath`、`setRunPath`
  - 伪静态：`getRewrite`、`setRewrite`、`getRewriteTemplate`
  - SSL 证书：`getSslStatus`、`deploySsl`、`closeSsl`、`setForceHttps`
- 新增 `pages/vhost/purchase.vue` 虚拟主机购买页面：
  - 套餐列表展示（磁盘、流量、域名数、数据库等配置）
  - 套餐选择高亮
  - 域名输入
  - 优惠码支持
  - 购买成功跳转详情页
- 新增 `pages/vhost/list.vue` 虚拟主机列表页面：
  - 主机列表展示（域名、状态、到期时间、套餐）
  - 状态筛选（全部、正常、即将过期、已过期）
  - 下拉刷新
  - 点击跳转详情页
- 新增 `pages/vhost/detail.vue` 虚拟主机详情页面：
  - 基本信息标签页：FTP 连接信息、数据库连接信息、套餐配置（带复制按钮）
  - 域名绑定标签页：已绑定域名列表、添加/删除域名、数量限制检查
  - 文件管理标签页：文件列表、目录导航（面包屑）、新建文件/目录、编辑/删除/重命名、复制/移动、压缩/解压
  - 设置标签页：PHP 版本切换、运行目录设置、伪静态规则（模板选择）、SSL 证书部署/关闭/强制 HTTPS
  - 续费功能
- 在个人中心页面添加虚拟主机入口（快捷操作和功能菜单）
- 在 `pages.json` 中配置虚拟主机相关页面路由

### 虚拟主机管理端
- 在 `api/admin.js` 中添加虚拟主机管理 API：
  - 服务器管理：`getVHostServers`、`addVHostServer`、`updateVHostServer`、`deleteVHostServer`、`testVHostServer`
  - 套餐管理：`getAdminVHostPlans`、`createVHostPlan`、`updateVHostPlan`、`deleteVHostPlan`
  - 主机实例管理：`getAdminVHostInstances`、`updateVHostInstance`、`deleteVHostInstance`、`batchDeleteVHostInstances`
  - 订单管理：`getAdminVHostOrders`、`deleteVHostOrder`、`batchDeleteVHostOrders`
  - 统计数据：`getVHostStats`
- 新增 `pages/admin/vhost.vue` 虚拟主机管理页面：
  - 统计标签页：显示总收入、本月收入、主机数、服务器数等统计数据
  - 服务器标签页：宝塔面板服务器的增删改查、测试连接
  - 套餐标签页：虚拟主机套餐的增删改查，支持配置磁盘、流量、域名数等
  - 主机标签页：主机实例列表、筛选、暂停/恢复、修改到期时间、删除、批量删除
  - 订单标签页：订单列表、筛选、删除、批量删除
- 在管理后台首页添加虚拟主机管理入口

### OAuth 第三方登录绑定
- 在 `api/auth.js` 中添加 OAuth 相关 API：
  - `getGithubStatus()` - 获取 GitHub OAuth 状态
  - `getGoogleStatus()` - 获取 Google OAuth 状态
  - `getNodelocStatus()` - 获取 NodeLoc OAuth 状态
  - `getOAuthBindable()` - 获取 OAuth 可绑定状态
  - `getOAuthAuthUrl(provider)` - 获取 OAuth 授权 URL
  - `bindOAuth(provider)` - 绑定 OAuth 账号
  - `unbindOAuth(provider)` - 解绑 OAuth 账号
- 在安全设置页面 `pages/settings/security.vue` 添加第三方账号绑定模块：
  - 支持 GitHub、Google、NodeLoc 三种 OAuth 绑定
  - 显示各 provider 的启用状态和绑定状态
  - 支持绑定和解绑操作
  - 处理 OAuth 回调参数
- 在登录页面 `pages/login/login.vue` 添加第三方登录入口：
  - 显示已启用的 OAuth 登录按钮
  - 支持 GitHub、Google、NodeLoc 快捷登录
  - 处理 OAuth 登录回调

### 阿里云邮件推送配置
- 在 `api/admin.js` 中添加 `testAliyunDM()` 测试阿里云邮件 API
- 在系统设置页面 `pages/admin/settings.vue` 添加阿里云邮件推送配置区块：
  - 启用/禁用开关
  - Access Key 和 Access Secret 配置
  - 区域选择（华东1-杭州、华北2-北京、华东2-上海、新加坡）
  - 发信地址配置
  - 测试发送功能
  - 启用状态与表单字段联动

## 2026-01-02

### 首页UI优化
- 优化"为什么选择我们"卡片样式
- 添加渐变背景色（蓝、绿、橙、紫）
- 图标改为彩色圆形渐变背景
- 增强视觉层次感和美观度

### 虚拟主机详情页优化
- 删除"套餐配置"卡片，简化页面

## 2025-12-31

### APP 端图形验证码支持
- 在 `utils/request.js` 中添加 `X-Client-Type: app` 请求头标识
- 在 `api/auth.js` 中添加 `getCaptchaConfig` 和 `checkRegisterStatus` 接口
- APP 端自动使用图形验证码，H5 端使用 Turnstile
- 登录、注册、忘记密码、修改密码、修改邮箱页面均已支持图形验证码
- 修复 `pages/admin/email-templates.vue` 模板变量显示的语法错误

### 用户管理增强
- 用户详情弹窗新增 OAuth 绑定信息显示
- 支持管理员解绑用户的 GitHub/Google/NodeLoc 账号
- 在 `api/admin.js` 中添加 OAuth 解绑接口

### 数据管理页面
- 新增 `pages/admin/data-manage.vue` 数据管理页面
- 支持导出用户数据为 CSV 格式
- 支持导出二级域名数据为 CSV 格式
- 支持导出卡密数据为 CSV 格式
- 支持从 CSV 批量导入用户
- 支持从 CSV 批量导入卡密
- 提供 CSV 格式说明
- 在管理后台首页添加数据管理入口

### 用户安全设置页面
- 新增 `pages/settings/security.vue` 安全设置页面
- 支持双因素认证 (2FA) 设置、启用、禁用
- 支持备用码生成和管理
- 支持 API 密钥生成、查看、重置
- 支持 API 启用/禁用切换
- 支持 API IP 白名单管理
- 支持登录 IP 限制设置
- 支持查看登录历史记录
- 在 `api/security.js` 中添加 API 密钥管理相关接口
- 在设置页面添加安全设置入口

### 管理端邮件模板管理
- 新增 `pages/admin/email-templates.vue` 邮件模板管理页面
- 支持查看所有邮件模板列表
- 支持编辑邮件模板主题和内容
- 支持模板变量提示
- 支持邮件预览功能
- 支持发送测试邮件
- 支持重置模板为默认
- 在 `api/admin.js` 中添加邮件模板管理相关接口

### 管理端 IP 黑名单管理
- 新增 `pages/admin/ip-blacklist.vue` IP 黑名单管理页面
- 支持查看黑名单列表
- 支持搜索 IP 地址
- 支持添加 IP 到黑名单（可设置封禁原因和时长）
- 支持解除 IP 封禁
- 支持分页浏览

### 管理端系统设置完善
- 重构 `pages/admin/settings.vue` 系统设置页面
- 新增注册设置：开放注册开关、新用户默认域名配额、邮箱后缀限制
- 新增验证码设置：Turnstile 开关及配置、各场景验证码开关
- 新增 OAuth 登录配置：GitHub、Google、NodeLoc
- 新增网站统计代码配置
- 优化页面 UI 布局，分组更清晰

### 管理后台入口更新
- 在管理后台首页添加邮件模板管理入口
- 在管理后台首页添加 IP 黑名单管理入口
